<h1>Public::Foods#show</h1>
<p>Find me in app/views/public/foods/show.html.erb</p>
お気に入り登録数/ <%= @food.favorite_foods.count %>

<%= @food.shop.name %>

<%= attachment_image_tag @food.shop, :shop_image, :fill, 30, 30, fallback: 'no_image.jpg' %>

<%= @food.name %>

<%= attachment_image_tag @food, :image, :fill, 60, 60 %>

<%= @food.introduction %>

<%= @food.genre.name %>

<%= @food.taste %>

<%= @food.price %>

<%= @food.calorie %>

<%= @food.food_temperature %>

<%= @food.sale_dates %>

<h2>また食べたい味と思ったユーザーの味の好み度統計</h2>

<%= @sweet_like_average %>
<%= @salty_like_average %>
<%= @bitter_like_average %>
<%= @sour_like_average %>
<%= @spicy_like_average %>


<% if user_signed_in? %>
  <% if @food.food_favorited_by?(current_user) %>
    <p>
      <%= link_to food_favorite_foods_path(@food), method: :delete do %>
        ♥<%= @food.favorite_foods.count %> いいね
      <% end %>
    </p>
    <% else %>
    <p>
      <%= link_to food_favorite_foods_path(@food), method: :post do %>
        ♡<%= @food.favorite_foods.count %> いいね
      <% end %>
    </p>
  <% end %>
<% end %>

<h2>レビューと評価</h2>

香りの強さ<%= @taste_strong_average.floor(1) %>
味の濃さ<%= @smell_strong_average.floor(1) %>


<% if user_signed_in? %>

  <% if @your_review.nil? %>
    <p>レビューする</p>

    <%= form_with model: @review, url: food_reviews_path(@food), method: :post, local:true do |f| %>

      <%= f.hidden_field :user_id, :value => current_user.id %>
      <%= f.hidden_field :food_id, :value => params[:id] %>
      <%= f.hidden_field :sweet_like, :value => current_user.sweet_like_before_type_cast %>
      <%= f.hidden_field :salty_like, :value => current_user.salty_like_before_type_cast %>
      <%= f.hidden_field :bitter_like, :value => current_user.bitter_like_before_type_cast %>
      <%= f.hidden_field :sour_like, :value => current_user.sour_like_before_type_cast %>
      <%= f.hidden_field :spicy_like, :value => current_user.spicy_like_before_type_cast %>

      <%= f.text_area :body %>

      <%= f.label :smell_strong %>
      <%= f.range_field :smell_strong, in: 0..10 %>

      <%= f.label :taste_strong %>
      <%= f.range_field :taste_strong, in: 0..10 %>

      <%= f.label :repeat %>

      <%= f.radio_button :repeat, true, :chacked => true %>
      <%= f.radio_button :repeat, false %>

      <div class="field" id="star-rating">
        <%= f.label :taste_score %>
        <%= f.hidden_field :taste_score, id: :review_star %>
      </div>

      <%= f.submit 'レビューを投稿する' %>
    <% end %>
  <% else %>

  <p>投稿したレビュー</p>
    <%= @your_review.body %>
    <div id="your-star-raty-<%= @your_review.id %>">
      <%= @your_review.taste_score %>
    </div>
    <%= link_to '編集する', edit_food_reviews_path(@food.id) %>
        <script>
      $('#your-star-raty-<%= @your_review.id %>').raty({
        size     : 36,
        starOff:  '<%= asset_path('star-off.png') %>',
        starOn : '<%= asset_path('star-on.png') %>',
        starHalf : '<%= asset_path('star-half.png') %>',
        half: true,
        readOnly: true,
        score: '<%= @your_review.taste_score %>'
      });
    </script>
      <%= @your_review.repeat %>
  <% end %>

<% else %>
  <p>新規登録 / ログインでレビュー投稿ができます。</p>
<% end %>

<% if @reviews.empty? %>
  <p>レビューがまだありません。</p>
<% else %>
  <% @reviews.each do |review| %>
      <%= review.body %>
      <%= link_to review.user.name, user_path(review.user.id) %>
    <div id="star-raty-<%= review.id %>">
      <%= review.taste_score %>
    </div>
      <%= review.repeat %>

    <script>
      $('#star-raty-<%= review.id %>').raty({
        size     : 36,
        starOff:  '<%= asset_path('star-off.png') %>',
        starOn : '<%= asset_path('star-on.png') %>',
        starHalf : '<%= asset_path('star-half.png') %>',
        half: true,
        readOnly: true,
        score: '<%= review.taste_score %>'
      });
    </script>
  <% end %>
<% end %>

<script>
  $('#star-rating').raty({
    size     : 36,
    starOff:  '<%= asset_path('star-off.png') %>',
    starOn : '<%= asset_path('star-on.png') %>',
    starHalf : '<%= asset_path('star-half.png') %>',
    half: true,
    scoreName: 'review[taste_score]'
  });
</script>